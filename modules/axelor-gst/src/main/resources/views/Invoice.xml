<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.2.xsd">

  <selection name="invoice.status.selection">
    <option value="draft">draft</option>
    <option value="validated">validated</option>
    <option value="paid">paid</option>
    <option value="cancelled">cancelled</option>
  </selection>

  <form model="com.axelor.gst.db.Invoice" title="Invoice Details" width="large"
    name="invoice-form"
    onNew="action-gst-invoice-record-set-company,action-gst-invoice-record-set-invoice-date"
    onSave="action-gst-invoice-method-on-save-set-reference">

    <panel name="invoiceStatusPanel">
      <field colSpan="12" name="statusSelect" widget="nav-select"
        readonly="true"></field>
    </panel>

    <panel itemSpan="12" sidebar="true" name="statusBtnPanel">
      <button name="statusDraftBtn" css="btn-primary" title="Draft"
        hidden="true" showIf="statusSelect =='cancelled'"
        onClick="action-attrs-invoice-on-click-change-status-draft" />
      <button name="statusVadidatedBtn" css="btn-success" title="Validated"
        showIf="statusSelect =='draft'" onClick="action-attrs-invoice-on-click-change-status-validated" />
      <button name="statusPaidBtn" css="btn-warning" title="Paid"
        showIf="statusSelect == 'validated'" onClick="action-attrs-invoice-on-click-change-status-paid" />
      <button name="statusCancelledBtn" css="btn-danger" title="Cancelled"
        hideIf="statusSelect =='cancelled'" onClick="action-attrs-invoice-on-click-change-status-canceled" />
    </panel>

    <panel itemSpan="3" name="overview">
      <field name="reference" />
      <field name="company" />
      <field name="invoiceDateT" />
      <field name="priority" />
    </panel>

    <panel itemSpan="6" name="partyDetailsPanel">
      <field name="party"
        onChange="action-gst-invoice-record-set-primary-contact-in-party,action-attrs-invoice-on-change-set-shipping-address" />
      <field name="partyContact" />
    </panel>

    <panel name="addressPanel">
      <field name="invoiceAddress" colSpan="5"
        onChange="action-attrs-invoice-on-change-set-shipping-address" />
      <field name="isInvoiceAddAsShippingAdd" colSpan="2"
        onChange="action-attrs-invoice-on-change-set-shipping-address" />
      <field name="shippingAddress" colSpan="5" hideIf="isInvoiceAddAsShippingAdd" />
    </panel>

    <panel-related field="invoiceLineList" css="panel-green" onChange="action-gst-invoice-line-method-on-new-set-total" >
    </panel-related>

    <panel colSpan="12" colOffset="2" css="panel-green" name="totalDetailsPanel">
      <field colSpan="2" title="Net Amount" readonly="true" name="netAmount"></field>
      <field colSpan="2" readonly="true" name="igst"></field>
      <field colSpan="2" readonly="true" name="cgst"></field>
      <field colSpan="2" readonly="true" name="sgst"></field>
      <field colSpan="2" readonly="true" name="grossAmount"></field>
    </panel>
  </form>

  <grid model="com.axelor.gst.db.Invoice" title="Invoice" name="invoice-grid">
    <field name="reference" />
    <field name="company" />
    <field name="invoiceDateT" />
    <field name="party" />
    <field name="grossAmount" />
    <field name="statusSelect" />
  </grid>

  <kanban name="invoice-kanban" title="Invoice" model="com.axelor.gst.db.Invoice"
    columnBy="status" sequenceBy="priority" limit="10"
    onMove="project.task.kanban.on.move" draggable="true">
    <field name="reference" />
    <field name="invoiceDate" />
    <field name="party" />
    <field name="grossAmount" />
    <template><![CDATA[
    <h4>{{reference}}</h4>
    <div class="card-body">{{party}}</div>
    <div class="card-footer">
        <span>{{invoiceDate|date:'yyyy-MM-dd HH:mm:ss'}}</span>
    </div>
    ]]></template>
  </kanban>

  <action-attrs name="action-attrs-invoice-on-click-change-status-draft">
    <attribute name="value" for="statusSelect" expr="eval:'draft'" />
  </action-attrs>

  <action-attrs name="action-attrs-invoice-on-click-change-status-validated">
    <attribute name="value" for="statusSelect" expr="eval:'validated'" />
  </action-attrs>

  <action-attrs name="action-attrs-invoice-on-click-change-status-paid">
    <attribute name="value" for="statusSelect" expr="eval:'paid'" />
  </action-attrs>

  <action-attrs name="action-attrs-invoice-on-click-change-status-canceled">
    <attribute name="value" for="statusSelect" expr="eval:'cancelled'" />
  </action-attrs>

  <!-- to set Default Shipping address -->
  <action-attrs name="action-attrs-invoice-on-change-set-shipping-address">
    <attribute name="value" if="isInvoiceAddAsShippingAdd" for="shippingAddress"
      expr="eval:invoiceAddress" />
  </action-attrs>

  <action-record name="action-gst-invoice-record-set-company"
    model="com.axelor.gst.db.Invoice">
    <field name="company" expr="" />
  </action-record>

  <action-record name="action-gst-invoice-record-set-invoice-date"
    model="com.axelor.gst.db.Invoice">
    <field name="invoiceDateT" expr="eval:__datetime__" />
  </action-record>

  <action-method name="action-gst-invoice-record-set-primary-contact-in-party"
    model="com.axelor.db.Invoice">
    <call class="com.axelor.gst.db.web.InvoiceController" method="setPrimaryContactAndAddressInInvoice" />
  </action-method>

  <action-method name="action-gst-invoice-method-on-save-set-reference"
    model="com.axelor.gst.db.Invoice">
    <call  class="com.axelor.gst.db.web.SequenceController" method="setReferenceInInvoice" />
  </action-method>

  <action-method name="action-gst-invoice-line-method-on-new-set-total"
    model="com.axelor.gst.db.Invoice">
    <call  class="com.axelor.gst.db.web.InvoiceController" method="setTotalInInvoice" />
  </action-method>

</object-views>
